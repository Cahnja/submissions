<!DOCTYPE html>

<html>
<div>
<canvas height="400" width="800" id="c"
	style="border:1px dotted lime">
</canvas>
</div>

<script>
var c = document.getElementById("c");
var ctx = c.getContext("2d");
var balls = [];
var pause = false;

var ball = function(x, y, r, ctx) {
   return {
      x:x,
      y:y,
      r:r,
      ctx:ctx,
      color:"#0f0f0f",
      dx:1,
      dy:1,
      draw:function() {
         ctx.fillStyle=this.color;
         ctx.beginPath();
         ctx.arc(this.x,this.y,this.r,0,2*Math.PI);
         ctx.fill();
      },
      move:function() {
         if (this.x - this.r <= 0 || this.x + this.r >= c.width) {
            this.dx = -this.dx;
         }
         if (this.y - this.r <= 0 || this.y + this.r >= c.height) {
            this.dy = -this.dy;
         }
         this.x += this.dx;
         this.y += this.dy;
      }
   };
}


var player = function(x,y,l,ctx) {
   return {
      x:x,
      y:y,
      l:l,
      ctx:ctx,
      dx:5,
      dy:5,
      color:"#ff0000",
      draw:function() {
         ctx.beginPath();
         ctx.moveTo(this.x-this.l/2,this.y+this.l/2);
         ctx.lineTo(this.x+this.l/2,this.y+this.l/2);
         ctx.lineTo(this.x,this.y-this.l/2);
         ctx.closePath();
         ctx.fillStyle = this.color;
         ctx.fill();
      },
      moveLeft:function() {
         this.x -= this.dx;
      },
      moveRight:function() {
         this.x += this.dx;
      },
      moveUp:function() {
         this.y -= this.dy;
      },
      moveDown:function() {
         this.y += this.dy;
      }
   };
}
         

var animloop = function() {
   if (!pause) {
      ctx.fillStyle="#30d080";
      ctx.fillRect(0,0,c.width,c.height);

      if (Math.random() < 0.01)
	 newBall();

      for (var i = 0; i < balls.length; i++) {
	 balls[i].draw();
         balls[i].move();
      }
      p1.draw();
   }
   window.requestAnimationFrame(animloop);
}

var newBall = function() {
   var rad = Math.random()*20 + 5;
   var x = Math.random()*(c.width - 2*rad) + rad;
   var y = Math.random()*(c.height - 2*rad) + rad;
   b1 = ball(x,y,rad,ctx);
   balls.push(b1);
}


var keypress = function(e) {
   console.log(e);
   if (e.keyCode === 37) {
      p1.moveLeft();
   } else if (e.keyCode === 39) {
      p1.moveRight();
   } else if (e.keyCode === 38) {
      p1.moveUp();
   } else if (e.keyCode === 40) {
      p1.moveDown();
   } else if (e.keyCode === 80) {
      pause = !pause;
   }			  
}

var p1 = player(400,300,10,ctx);
var b1 = ball(50, 50, 6, ctx);
b1.dx = -1;
balls.push(b1);


window.addEventListener("keydown",keypress);
window.requestAnimationFrame(animloop);
</script>
</html>
