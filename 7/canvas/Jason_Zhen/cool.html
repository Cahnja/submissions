<!DOCTYPE html>

<html>

Arrow Keys to move. Press numbers to summon bullets.
More to come.
<canvas height="480" width="960" id="c"
	style="border:1px solid black">
</canvas>

<script>
  var c = document.getElementById("c");
  var ctx = c.getContext("2d");
  var start = false;
  
  var height=480;
  var width=960;
  var difficulty=1;
  
  var startScreen = function() {
   ctx.font="30px arial";
   ctx.strokeStyle="#0000ff";
   ctx.fillText("A Cool Thing",400,100);
   ctx.font="20px arial";
   ctx.fillText("Click Anywhere to Start",380,150);
   ctx.stroke();
  }
  

  var setup = function(e) {
   e.preventDefault();
   if (start == false){
    ctx.fillStyle="#ffffff";
    ctx.fillRect(0,0,width,height);
    ctx.stroke();
    start= true;
    }
  } 

  var player = function(x,y,w,h,ctx) {
   return {
     x:x,
     y:y,
     w:w,
     h:h,
     ctx:ctx,
     color:"#000000",
     dx:10,
     dy:10,

     draw:function() {
       ctx.fillStyle=this.color;
       ctx.fillRect(this.x,this.y,this.w,this.h);
       ctx.stroke();
     },

     move:function(dir) {
        if (dir=="LEFT"){this.x=this.x-this.dx;}
        if (dir=="UP"){this.y=this.y-this.dy;}
        if (dir=="RIGHT"){this.x=this.x+this.dx;}
        if (dir=="DOWN"){this.y=this.y+this.dy;}
    }

  };
  }
  
 var bullet = function(x,y,ctx){
  return {
   x:x,
   y:y,
   r:10,
   ctx:ctx,
   color:"blue",
   dx:5,
   dy:5,
   //cx1: this.x+.5*this.r,
   //cx2: this.x+1.5*this.r,
   //cy1: this.y+.5*this.r,
   //cy2: this.y+1.5*this.r,
   //x2:this.x+this.r+this.r,
   //y2:this.y+2*this.r,
   px:p.x,
   py:p.y,
   draw:function() {
    ctx.beginPath();
    ctx.arc(this.x,this.y,this.r,0,2*Math.PI);
    ctx.fillStyle=this.color;
    ctx.fill();  
    ctx.stroke();
   },

   move:function() {
     //if (this.x<this.px){this.x=this.x+this.dx;}
     //if (this.y<this.py){this.y=this.y+this.dy;}
     //if (this.x>this.px){this.x=this.x-this.dx;}
     //if (this.y>this.py){this.y=this.y-this.dy;}
    this.x=this.x;
    this.y=this.y+this.dy;
   }
  }
 }
  var readKeys = function(e){
    e.preventDefault();
    e = e || window.event;
  //console.log(e.which);
    if (e.which==37){p.move("LEFT");}
    if (e.which==38){p.move("UP");}
    if (e.which==39){p.move("RIGHT");}
    if (e.which==40){p.move("DOWN");}
    if (e.which==49){pattern1();}
    
  }   
  
  var spawn = function(x,y,ctx){
   bullets.push(bullet(x,y,ctx));
  }

  var clickSpawn = function(e) {
   e.preventDefault();
   spawn(e.offsetX,e.offsetY,ctx);
  }

  var pattern1 = function(start,int,end) {
   if (typeof(start)=='undefined'){start=0;}
   if (typeof(int)=='undefined'){int=60;}
   if (typeof(end)=='undefined'){end=width;}
   for (var i = 1; i<=end/int-1;i++){
	spawn(start+i*int,0,ctx);
   }
  }

  var animloop = function(){
   ctx.clearRect(0,0,width,height);
   p.draw();
 //for (var i = 0; i<difficulty; i++){spawn(width*Math.random(),0,ctx);}
   for (var i = 0; i <bullets.length; i++){
     bullets[i].move();
     bullets[i].draw();
     collisionDetection();
     if (bullets[i].y>height){bullets.shift();}				     
   }

    window.requestAnimationFrame(animloop);
   
}

   var collisionDetection = function(){
     for (var i = 0;i<bullets.length;i++){
	console.log("here");
     if ( bullets[i].x< p.x+p.w && 
          bullets[i].x+bullets[i].r>p.x && 
          bullets[i].y< p.y+p.h && 
          bullets[i].y+bullets[i].r>p.y )
         {console.log("hit");
       }
     }
   }
				      
var p = player(width*.5,height*.5,10,10,ctx);
var bullets=[];


document.onkeydown=readKeys;
window.requestAnimationFrame(animloop);
c.addEventListener("click",clickSpawn);


</script>


</html>
